# セキュリティ設計＋PIA（個人情報保護影響評価）— PlanForge LG（MVP）

- 文書番号: PF-SEC-001
- 版数: v0.1
- 作成日: 2025-10-03
- 関連: PF-REQ-001, PF-NFR-001, PF-BIZ-001, PF-API-001, PF-DM-001

------

## 1. 目的・適用範囲

本書はMVPにおけるセキュリティ設計とPIAの要件を定義する。対象はアプリ、API、DB、ストレージ、監査ログ、エクスポート成果物、開発運用。

------

## 2. データ分類と取り扱い

| 区分             | 例                                   | 既定の扱い                                                   |
| ---------------- | ------------------------------------ | ------------------------------------------------------------ |
| P0 機微/個人情報 | 住所・氏名・電話・メール・要配慮情報 | 画面入力を禁止または即時マスキング。添付はアップロード拒否。 |
| P1 内部情報      | 未公開計画、試算、監査ログ           | 暗号化保管、プロジェクトRBAC、外部共有禁止。                 |
| P2 公開可        | 脚注付き公開版、テンプレ             | 公開用エクスポートのみ許可。                                 |

- P0/P1/P2はプロジェクト単位のポリシーで上書き可能。
- 出力時はP0検知でブロックし、箇所をハイライト。

------

## 3. 認証・認可

- 認証: アプリ内アカウント（MVP）。セッションCookieまたはBearer。
- 認可: プロジェクト単位RBAC（owner/editor/viewer）。
- セッション管理: `HttpOnly/SameSite=strict/Secure`。タイムアウト 30分無操作。
- アカウントロック: 認証連続失敗 10 回/15分。

------

## 4. 通信・保管暗号化

- 通信: TLS 1.2 以上。HSTS有効化。
- 保管: DB/オブジェクトストレージのサーバサイド暗号化。バックアップ含む。
- エクスポート成果物: 保存時にハッシュ付与、ダウンロードURLは短期署名。

------

## 5. シークレット・鍵管理

- 秘密情報は環境変数管理。リポジトリコミット禁止。
- キーのローテーションは90日。
- LLMアクセスキーは最小権限、用途別に分離。

------

## 6. ログ・監査

- 監査ログは追記専用ストレージ（擬似WORM）。
- 個別操作の記録: `actor_id, action, project_id, timestamp, result`。
- AI推論の記録: `model_id, prompt_id, tokens, latency, input/outputハッシュ`。
- P0は監査ログに原文を残さない。必要なら匿名化サマリ。

------

## 7. 入力検証・出力制御

- サーバ側バリデーション必須（型、長さ、範囲、列挙値）。
- 比率は0〜1のみ。SQL/テンプレに対してはパラメータ化。
- 出力前チェック: P0残存、assumption/evidence欠落（要出典状態の残存）、監査記録有無。

------

## 8. 脆弱性管理・依存ライブラリ

- 週次スキャン。高危険度は7日以内修正。
- 依存は固定バージョン。SBOM生成。
- SAST/DASTをCIに組み込み。主要OWASP項目を回帰。

------

## 9. レート制限・DoS緩和

- 既定 60 req/分/ユーザー、バースト制限。
- 生成系APIは同時実行上限をユーザー単位で1。
- 大型応答はストリーミングまたは非同期化。

------

## 10. 環境分離

- `dev/stg/prod` を論理分離。データは交差禁止。
- 本番データの開発流用禁止。必要時は匿名化ダンプ。

------

## 11. インシデント対応

- 初動目標: 2時間以内に影響評価と暫定封じ込め。
- 24時間以内に再発防止案と暫定パッチ。
- 監査・関係部局への報告テンプレを同梱。

------

## 12. 供給網（サプライチェーン）

- サードパーティ利用は台帳管理（事業者名、目的、データ範囲、DPA有無）。
- 外部LLMや変換サービスのデータ保持ポリシーを記録。保持0を優先。

------

## 13. 代表的データフロー（テキスト）

```
ブラウザ → API（認証） → DB/オブジェクト
            └→ LLM推論（サーバ側） → 監査ログ
エクスポート → オブジェクト保存（短期署名URL） → ダウンロード
```

------

## 14. 脅威モデル（STRIDE要約）

| カテゴリ       | リスク例               | 対策                                     |
| -------------- | ---------------------- | ---------------------------------------- |
| S 偽装         | セッションハイジャック | Secure/HttpOnly/SameSite、短期セッション |
| T 改ざん       | 監査ログの書換         | 追記専用ストレージ、整合性ハッシュ       |
| R 否認         | 操作の否認             | 相関ID、監査ログ必須                     |
| I 情報漏えい   | P0混入・誤共有         | 入力禁止/マスキング、外部共有禁止        |
| D サービス拒否 | 生成系連打             | レート制限、同時実行1                    |
| E 権限昇格     | APIの不備              | RBACサーバ評価、機能フラグでガード       |

------

## 15. セキュリティテスト計画（抜粋）

- 静的解析（SAST）: PRごと。
- 動的解析（DAST）: ステージングで週次。
- 侵入テスト: MVPリリース前に簡易実施。
- 役割別アクセス試験: viewer/editor/owner の負ケースを網羅。

------

## 16. PIA（個人情報保護影響評価）

### 16.1 対象・前提

- MVPではP0の収集を禁止または即時マスキング。
- 監査ログにP0原文を保存しない。

### 16.2 収集・利用の最小化

- 収集目的: 企画文書生成のための業務情報。
- 必要最小の属性のみ保持。P0は不要。

### 16.3 リスク評価（例）

| リスク             | 可能性 | 影響 | 緩和策                                           |
| ------------------ | ------ | ---- | ------------------------------------------------ |
| P0誤入力           | 中     | 高   | 入力禁止、キーワード検知、アップロード拒否       |
| エクスポート誤公開 | 低     | 高   | ブロック条件、公開用テンプレ、権限で外部共有禁止 |
| 監査ログからの推測 | 低     | 中   | 匿名化要約、原文保存禁止                         |

### 16.4 利用者の権利

- 開示・訂正・削除の請求経路を運用手順に記載。
- P0は原則保持しないため、削除はメタデータ対象。

### 16.5 第三者提供

- MVPで外部提供は原則行わない。将来の提供時はDPA締結を必須。

------

## 17. 運用手順（要点）

- 権限付与/剥奪の申請フローと月次棚卸。
- 監査ログの閲覧は監査・情報政策のみ。
- バックアップの復元ドリルを四半期に一度。

------

## 18. 受け入れ基準（セキュリティ/PIA）

- RBACが機能し、viewerがエクスポート不可。
- P0検知でエクスポートがブロックされ、箇所特定が可能。
- TLS強制、Cookie属性適用を確認。
- SAST/DASTで高危険度0件。
- インシデント手順の机上演習を完了。

------

## 19. 未確定事項

- 二要素認証の導入時期（v1候補）。
- 監査ログの保持年限（各団体規程に依存）。
- 外部共有方針の最終決定。

------

## 20. 変更履歴

- v0.1（2025-10-03）初稿