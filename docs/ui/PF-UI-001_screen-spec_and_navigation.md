# 画面設計書（ワイヤ・遷移）— PlanForge LG（MVP）

- 文書番号: PF-UI-001
- 版数: v0.1
- 作成日: 2025-10-03
- 関連: PF-REQ-001, PF-NFR-001, PF-UC-001, PF-API-001, PF-DM-001

------

## 1. 目的

MVPで提供する画面、入出力項目、遷移、検証ルール、エラーメッセージ、アクセシビリティ要件を定義する。外部フレームワーク依存の細部は避け、機能要件と突き合わせ可能な粒度に留める。

------

## 2. 画面一覧（ID対応）

- G-01: プロジェクト一覧
- G-02: プロジェクト概要（メタ＋進捗）
- G-03: Whyウィザード
- G-04: 追撃質問キュー
- G-05: ロジックツリー編集
- G-06: フレームワーク入力（PEST/3C/SWOT/5F）
- G-07: 市場規模試算（TAM/SAM/SOM）
- G-08: 出力プレビュー（章立て・脚注）
- G-09: 監査ログビュー

------

## 3. 共通UI仕様

- フォーム最大幅 960px、2カラムまで。
- 入力上限: 200字（UTF-8ベース）。超過時は自動要約提案＋元文保持。
- ラベル右に必須は「*」、任意は無印。
- 保存ステートはトーストで通知。
- エラーはフィールド直下に1行、ページ上部に集約ダイジェスト。
- キーボード操作: Tab順序固定、主要操作はショートカット（保存: Ctrl/Cmd+S、検査: Alt+K、生成: Alt+G）。
- 語彙は用語辞書に準拠。自動正規化発生時は薄灰で差分表示。

------

## 4. 画面詳細

### G-01 プロジェクト一覧

**目的**: 検索と新規作成、最近編集のアクセス。
 **主要要素**

- 検索ボックス（プレースホルダ: タイトル/地域コード）
- テーブル: タイトル、カテゴリ、最終更新、所有者、権限、進捗%
- ボタン: 新規作成、インポート（v1以降）
   **検証**
- 検索は前方一致。0件時は「該当なし」。
   **エラー文例**
- 取得失敗: 「一覧の取得に失敗しました。再読込してください。」

------

### G-02 プロジェクト概要

**目的**: メタ情報、進捗、未完了タスクの俯瞰。
 **主要要素**

- メタ: タイトル、地域コード、カテゴリ、作成者
- 進捗: セクション別完了率（Why/Logic/Framework/Market/Export）
- 未完了: 追撃質問件数、未確定数、矛盾件数
- CTA: Why編集へ、ロジックへ、フレームワークへ、試算へ、プレビューへ
   **補助**
- 監査ショートビュー（直近5イベント）

------

### G-03 Whyウィザード

**目的**: 最小入力でWhy要約を確定。
 **入力項目**

- 背景（任意、推奨）
- 望ましい将来像（任意）
- 成功条件（複数、任意）
- 制約（複数、任意）
- 利害関係者（複数、任意）
   **アクション**
- 下書き保存、要約生成、次へ（質問へ）
   **バリデーション**
- いずれかの項目に入力があれば生成可能。背景が空の場合は警告バッジを表示（「背景未入力のため、精度が低下する可能性があります」）。
- 200字を超えた場合、要約提案ダイアログを表示。
   **生成結果**
- Why要約（1文）をページ下部に表示し、編集可。
   **エラー文例**
- 「いずれかの項目を入力してください。」
- 「背景未入力のため、精度が低下する可能性があります。」

------

### G-04 追撃質問キュー

**目的**: SMART不足、矛盾、根拠欠落を質問で埋める。
 **UI**

- 質問カード（最大5件/ページ）。`blocking` は赤帯。
- 回答型: text / formula / choice
- 「後で回答」→ status=skipped だが件数バッジに残存
   **エラー文例**
- 「回答形式が不正です（期待: {expects}）。」

------

### G-05 ロジックツリー編集

**目的**: 自動生成したツリーの承認、修正、検査。
 **UI**

- 左: ツリービュー（折りたたみ）
- 右: 詳細ペイン（rationale、assumptions、必要データ）
- ツールバー: 生成、検査、パッチ適用、同義語統合
   **操作**
- ドラッグで並べ替え不可（因果の誤解を防ぐ）。親子変更はモーダルでのみ。
- ノードに「confidence」バッジ。
   **検査結果表示**
- 3タブ: 重複、飛躍、矛盾。各項目は「適用」ボタンでパッチ適用。
   **エラー文例**
- 「パッチ適用に失敗しました。再度検査を実行してください。」

------

### G-06 フレームワーク入力

**目的**: PEST/3C/SWOT/5F の最小入力→統合要旨。
 **UI**

- タブ: PEST / 3C / SWOT / 5F
- 各フィールド100〜200字。
- 統合結果プレビュー（右ペイン、Markdown表示）
- 「矛盾ログ」サイドパネル
   **エラー文例**
- 「用語正規化に失敗。再試行してください。」

------

### G-07 市場規模試算

**目的**: SOM Low/Med/High と寄与度。
 **入力**

- TAM人口、SAM人口、1人あたり年平均利用回数（low/mode/high）
- 到達率（low/mode/high）、転換率（low/mode/high）
   **表示**
- 結果カード: SOM Low/Med/High
- トルネード図（寄与度）
- 前提テーブル（assumptionsリンク）
   **検証**
- 0未満、1超の比率はエラー。
   **エラー文例**
- 「到達率は0〜1で入力してください。」

------

### G-08 出力プレビュー

**目的**: 章立て整合、脚注、未確定表示を確認。
 **UI**

- 左: 章見出し目次
- 右: プレビュー（脚注番号、未確定タグを強調）
- CTA: エクスポート（md / docx）
   **ブロック条件（発火時はダイアログ）**
- P0残存
- assumption/evidence欠落（要出典状態の残存）
- 監査ログ未記録（重大操作）
   **エラーダイアログ例**
- 「P0相当のデータが残存しています。該当箇所を修正してください。」
- 「要出典のAssumptionが残存しています。Evidenceを紐付けてください。」

------

### G-09 監査ログビュー

**目的**: 任意段落から出典・前提・生成履歴へトレース。
 **UI**

- フィルタ: アクション種別、期間、操作者
- リスト: 時刻、アクション、要約、モデル、遅延
- 詳細: 入出力要約、関連段落、プロンプトID
   **操作**
- プレビュー側から「この段落の監査へ」遷移可。

------

## 5. 画面遷移図（簡易）

```
G-01 一覧
  └→ 新規 → G-02 概要
G-02 概要
  ├→ Why編集 → G-03
  ├→ ロジック → G-05
  ├→ フレームワーク → G-06
  ├→ 試算 → G-07
  ├→ プレビュー → G-08
  └→ 監査 → G-09
G-03 → 質問へ → G-04 → ロジックへ → G-05
G-05 → 検査→パッチ → G-05（更新）
G-06 → 統合 → G-06（要旨更新）
G-07 → 計算 → G-07（結果更新）
G-08 → エクスポート（md/docx）
```

------

## 6. 入力検証・エラーメッセージ規約

- 規約: 短く具体、原因→対処の順。「○○を入力してください」「0〜1で入力してください」。
- プレースホルダで例示。「例: 徒歩圏2,800人」
- 数値は半角のみ。小数は`.`、千区切りは入力不可。
- 比率は0〜1、百分率入力は不可。

------

## 7. アクセシビリティ

- フォーム要素はlabelと関連付け。
- コントラスト比 AA。
- 代替テキスト: 図・警告バナーに付与。
- キーボード: 全操作可能。モーダルはフォーカストラップ。
- ライブリージョン: 保存・検査結果・ブロック通知。

------

## 8. 状態表示・アイコン

- confidence: high/med/low をバッジ色で差別化（色覚対応のテキスチュア併用）。
- 未確定: 角括弧＋灰色バッジ `[未確定]`。
- 矛盾: 三角警告アイコン＋「矛盾 #件」。
- P0検知: 赤バナー固定表示（スクロール追従）。

------

## 9. 権限別挙動

- Viewer: 入力フォームは全てread-only、エクスポート不可。
- Editor: 生成/検査/試算/エクスポート可。
- Owner: 権限変更、プロジェクト削除、庁内ユーザー招待可。

**共有機能の仕様**
- 共有は庁内限定。Ownerが認証済みユーザーのメールアドレスを指定して招待。
- 招待されたユーザーはOwner/Editor/Viewerいずれかの権限を付与される。
- リンクによる匿名アクセス、庁外メールアドレスへの招待は不可（MVPでは実装しない）。

------

## 10. テレメトリ（UI）

- 生成/検査/試算の所要時間、キャンセル率、エラー比。
- 未確定ブロックの解除までの操作数。
- プレビュー→エクスポート到達率。

------

## 11. 受け入れ観点（UI）

- 各画面で必要項目がフォールドせず一望できること（最大2スクロール以内）。
- エラー発生時、原因フィールドが自動スクロールで可視化されること。
- キーボードのみで一連の作業を完遂できること。

------

## 12. 変更履歴

- v0.1（2025-10-03）初稿