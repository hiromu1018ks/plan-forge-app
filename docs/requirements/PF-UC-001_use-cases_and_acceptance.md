# ユースケース定義 & 受け入れ基準 — PlanForge LG（MVP）

- 文書番号: PF-UC-001
- 版数: v0.1
- 作成日: 2025-10-03
- 関連: PF-REQ-001（要件）, PF-NFR-001（非機能）, PF-BIZ-001（業務要件）

---

## 1. 目的
MVPで実装する主要フローのユースケースと、受け入れ基準（Given/When/Then）を明確化する。

---

## 2. 対象範囲（MVP）
1) Whyウィザード入力  
2) 追撃質問（Interviewer-Bot）回答→構造化  
3) ロジックツリー生成（Logic-Coach）  
4) ロジック検査とパッチ適用  
5) フレームワーク最小入力→統合要旨生成（Framework-Fuser）  
6) 市場規模試算・感度（Scenario-Lab）  
7) 出力プレビュー→エクスポート（md/docx）  
8) 監査ログ参照（Auditor-Trail）

---

## 3. ユースケース定義（Given/When/Then）

### UC-01: Whyウィザード入力と要約生成
**アクター**: 企画担当  
**目的**: 最小入力からWhy要約・質問キューを生成  
**受け入れ基準**
- Given: プロジェクトが新規作成済みである
  When: 背景/将来像/成功条件/制約/関係者のいずれかを入力して保存する
  Then: 1文のWhy要約が生成され、未入力項目に対する質問キュー（最大5件）が作成される
- Then: 文字数超過は自動要約され、超過警告が表示される
- Then: 生成物には `assumption/confidence/evidence[]` が紐付く（要出典状態は evidence[] が空配列）

---

### UC-02: 追撃質問への回答と構造化
**アクター**: 企画担当  
**目的**: 回答を構造化フィールドに反映  
**受け入れ基準**
- Given: 質問キューが表示されている  
  When: 回答を送信する  
  Then: 回答は型（formula/choice/text）に沿って検証され、Whyデータに反映される  
- Then: 未回答が残る場合、残件数がヘッダに表示される

---

### UC-03: ロジックツリー自動生成
**アクター**: 企画担当  
**目的**: Whyから第1階層3〜5本の分解案を得る  
**受け入れ基準**
- Given: Why要約と制約が確定している  
  When: 「ロジック生成」を実行する  
  Then: 第1階層3〜5本と各子階層が生成され、各ノードに rationale・必要データ・confidence が付与される  
- Then: 同義語は正規化辞書で統一される

---

### UC-04: ロジック検査とパッチ適用
**アクター**: 分析担当  
**目的**: MECE/重複/飛躍/矛盾を検出し修正  
**受け入れ基準**
- Given: 生成済みロジックツリーがある  
  When: 「検査」を実行する  
  Then: 重複（keep/merge提案）、飛躍（中間仮説提案）、矛盾（参照元と修正ヒント）が一覧表示される  
- When: 提案パッチを適用する  
  Then: ノードがマージ/追加/注記され、監査ログに差分が記録される

---

### UC-05: フレームワーク最小入力→統合要旨
**アクター**: 企画担当  
**目的**: PEST/3C/SWOT/5Fの最小入力から1ページ要旨を得る  
**受け入れ基準**
- Given: 各枠に100〜200字の入力がある（空欄可）  
  When: 「統合」を実行する  
  Then: 用語が正規化され、Markdownの1ページ要旨と矛盾ログが生成される  
- Then: 空欄はAI補完されるが `confidence=low` と「要出典」タグが付く

---

### UC-06: 市場規模試算・感度（TAM/SAM/SOM）
**アクター**: 分析担当  
**目的**: SOMのLow/Med/Highと寄与度を算出  
**受け入れ基準**
- Given: population/sam/reach/conversion/visits のレンジが入力済み  
  When: 「試算」を実行する  
  Then: SOMのLow/Med/Highが算出され、寄与度ランクが出力される  
- Then: すべての数値に前提テーブル（assumptions）がリンクする

---

### UC-07: 出力プレビューとエクスポート
**アクター**: 企画担当  
**目的**: 章立てプレビュー確認とmd/docx出力  
**受け入れ基準**
- Given: ロジック・要旨・試算が揃っている
  When: 「プレビュー」を表示する
  Then: 章立て・図・脚注が整合し、未確定箇所は明示される
- When: 「エクスポート（md/docx）」を実行する
  Then: P0データの残存、assumption/evidence欠落（要出典状態の残存）がある場合はビルドがブロックされ、該当箇所がハイライトされる
- Then: 生成ファイルに版番号・ハッシュが付与される

---

### UC-08: 監査ログ参照
**アクター**: 監査/情報政策  
**目的**: 任意段落から出典・前提・生成履歴へトレース  
**受け入れ基準**
- Given: 決裁版の出力が存在する
  When: 任意の段落を選択する
  Then: 関連する assumption / evidence / 生成履歴（日時/操作者/モデル/プロンプトID）に遷移できる
- Then: ログは追記専用で改ざん不可の保存先にある

---

## 4. 完了の定義（DoD）
- 全UCで受け入れ基準をE2Eテストで満たす  
- 出力の章立て・脚注・図番号が全サンプルで一致  
- P0検知・assumption欠落・出典欠落の各ブロック条件が機能  
- 監査ログから段落→出典・前提→生成履歴の往復が可能

---

## 5. 例外・エラー扱い（抜粋）
- LLMタイムアウト時は再試行1回、以降は非同期完了通知  
- フィールド検証エラーは項目下に簡潔表示、保存不可  
- 依存欠落（例: 試算前のSAM未入力）はブロッカーとして明示

---

## 6. 変更履歴
- v0.1（2025-10-03）初稿